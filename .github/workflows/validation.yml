name: Validate Production Pull Request



on:

  pull_request:

    branches:

      - main

    paths:

      - 'force-app/**'



jobs:

  validate:

    runs-on: ubuntu-latest

    steps:

      - name: Checkout repository

        uses: actions/checkout@v3



      - name: Install Salesforce CLI

        run: npm install --global @salesforce/cli



      - name: Install Salesforce Scanner Plugin

        run: sf plugins install @salesforce/sfdx-scanner



      - name: Run Salesforce Code Analyzer (Scanner)

        run: |

          mkdir -p reports

          sf scanner:run \

            --format json \

            --target "force-app/main/default/classes/**/*.cls,force-app/main/default/lwc/**/*.js" \

            --category "Design,Best Practices,Performance,Code Style" \

            --outfile reports/scanner-report.json || true

          zip -j reports/scanner-report.zip reports/scanner-report.json



      - name: Upload Salesforce Scanner Report

        uses: actions/upload-artifact@v4

        with:

          name: scanner-report

          path: reports/scanner-report.zip



      - name: Validate on our Org (Dry Run)

        uses: jawills/sf-deploy@v1.0

        with:

          SFDX_AUTH_URL: ${{ secrets.SFDX_AUTH_URL }}

          DRY_RUN: true

          TEST_LEVEL: NoTestRun

